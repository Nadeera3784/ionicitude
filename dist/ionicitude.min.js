"use strict";function UnsupportedFeatureError(){var e=Error.apply(this,arguments);e.name=this.name="UnsupportedFeatureError",this.stack=e.stack,e.message?this.message=e.message:this.message="AR World loading error : Your device does not support one or several of it's requested features."}UnsupportedFeatureError.prototype=Object.create(Error.prototype,{constructor:{value:UnsupportedFeatureError,writable:!0,configurable:!0}}),function(){function e(e,n){function r(){return e(function(e){y.getSDKBuildInformation(function(n){e(n)})})}function t(){return e(function(e){y.getSDKVersion(function(n){e(n)})})}function o(){return n.info("requesting access for",E.reqFeatures),e(function(e,r){y.requestAccess(function(r){n.debug("requestAccess - success",r),e(r)},function(e){n.error("requestAccess - error",e),r(e)},E.reqFeatures)})}function i(e){b&&angular.isFunction(e)?e():k.push(e)}function a(){return n.debug(Object.getOwnPropertyNames(F)),Object.getOwnPropertyNames(F)}function u(n,r){if("boolean"!=typeof n)throw new TypeError("Ionicitude - captureScreen() expects first parameter to be of type 'boolean', '"+typeof n+"' given.");if(null!==r&&"string"!=typeof r)throw new TypeError("Ionicitude - captureScreen() expects second parameter to be 'null' or of type 'string', '"+typeof r+"' given.");var t=e.defer();return y.captureScreen(function(e){t.resolve(e)},function(e){t.reject(e)},n,r),t.promise}function s(e,n){function r(e){if(F.hasOwnProperty(e))throw new SyntaxError("Ionicitude - addAction() - The name '"+e+"' has already been added or is a reserved Ionicitude name.")}if(angular.isString(e)){if(!n)throw new TypeError("Ionicitude - addAction() expects a second argument if first argument is of type 'string'.");if("function"!=typeof n)throw new TypeError("Ionicitude - addAction() expects second argument to only be of type 'function', '"+typeof n+"' given.");r(e),F[e]=n}else{if(!angular.isFunction(e))throw new TypeError("Ionicitude - addAction() expects first argument to be only of type 'string' or 'function', '"+typeof e+"' given");var t=e.name;if(!t)throw new TypeError("Ionicitude - addAction() do not accept anonymous function as first argument. Please, try passing a named function instead.");r(t),F[t]=e}return v}function c(){n.info("checking device");var r=e.defer();return y.isDeviceSupported(function(e){n.log(e),v.deviceSupportsFeatures=!0,r.resolve(e)},function(e){n.error(e),v.deviceSupportsFeatures=!1,r.reject(e)},E.reqFeatures),r.promise}function l(r){function t(){var e=g;i()&&(e=r.customCallback),y.setOnUrlInvokeCallback(e)}function o(){u()&&(E.reqFeatures=r.reqFeatures),s()&&(E.worldLoadConfig=r.worldLoadConfig),l()&&(E.worldsRootFolder=r.worldsRootFolder)}function i(){return r&&r.hasOwnProperty("customCallback")&&angular.isFunction(r.customCallback)}function a(){return!(r&&r.hasOwnProperty("doDeviceCheck")&&r.doDeviceCheck===!1)}function u(){return r&&r.hasOwnProperty("reqFeatures")&&angular.isArray(r.reqFeatures)}function s(){return r&&r.hasOwnProperty("worldLoadConfig")&&angular.isObject(r.worldLoadConfig)}function l(){return r&&r.hasOwnProperty("worldsRootFolder")&&angular.isString(r.worldsRootFolder)}return e(function(e,r){b?r("Ionicitude has already been initialized !"):(n.info("init service starting"),w().then(m).then(t).then(function(){return a()?c():n.info("check skipped due to init settings")}).then(o).then(function(){b=!0}).then(f).then(function(){n.info("end of initialization"),e(v)}).catch(function(e){r(e)}))})}function d(r){if(r||(r="main"),v.deviceSupportsFeatures){var t=e.defer();return n.info("launch"),y.loadARchitectWorld(function(e){t.resolve(e)},function(e){t.reject(e)},p(r),E.reqFeatures,E.worldLoadConfig),t.promise}throw new UnsupportedFeatureError}function f(){k.forEach(function(e){angular.isFunction(e)&&e()}),k=[]}function p(e){return"www/"+E.worldsRootFolder+"/"+e+"/index.html"}function g(e){var r=h(e);if(n.debug(e,r),!F.hasOwnProperty(r.funcName)||"function"!=typeof F[r.funcName])throw new TypeError("'"+r.funcName+"' is either undefined or not a function in the Ionicitude service.");F[r.funcName](y,r.parameters)}function h(e){if(e=decodeURI(e),e.substr(0,S.length)===S){var n={},r=e.substr(S.length),t=r.indexOf("?");if(t===-1)n.funcName=r,n.parameters=null;else try{n.funcName=r.substr(0,t);var o=r.substr(t+1);n.parameters=angular.fromJson(o)}catch(e){throw e instanceof SyntaxError?new SyntaxError("parseActionUrl() expects the substring following the '?' in the parameter string to be a valid JSON object. '"+o+"' given."):e}return n}throw new SyntaxError("parseActionUrl() expects first parameter to be a string starting with '"+S+"'.")}function w(){return e(function(e,n){y?n("Plugin already loaded !"):(y=cordova.require("com.wikitude.phonegap.WikitudePlugin.WikitudePlugin"),e("Plugin is loaded."))})}function m(){v.close=y.close,v.hide=y.hide,v.show=y.show,v.callJavaScript=y.callJavaScript,v.setLocation=y.setLocation,v.setErrorHandler=y.setErrorHandler,v.setDeviceSensorsNeedCalibrationHandler=y.setDeviceSensorsNeedCalibrationHandler,v.setDeviceSensorsFinishedCalibrationHandler=y.setDeviceSensorsFinishedCalibrationHandler,v.setBackButtonCallback=y.setBackButtonCallback,v.openAppSettings=y.openAppSettings}var y,v={deviceSupportsFeatures:!1,checkDevice:c,requestAccess:o,getSDKBuildInformation:r,getSDKVersion:t,init:l,launchAR:d,addAction:s,listLibActions:a,captureScreen:u,ready:i,close:null,hide:null,show:null,callJavaScript:null,setLocation:null,setErrorHandler:null,setDeviceSensorsNeedCalibrationHandler:null,setDeviceSensorsFinishedCalibrationHandler:null,setBackButtonCallback:null,openAppSettings:null},b=!1,S="architectsdk://",F={},k=[],E={worldLoadConfig:{camera_position:"back"},reqFeatures:["geo","2d_tracking"],worldsRootFolder:"wikitude-worlds"};return v}e.$inject=["$q","$log"],angular.module("ionicitude-module",[]),angular.module("ionicitude-module").factory("Ionicitude",e)}();