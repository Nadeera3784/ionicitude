"use strict";function UnsupportedFeatureError(){var e=Error.apply(this,arguments);e.name=this.name="UnsupportedFeatureError",this.stack=e.stack,e.message?this.message=e.message:this.message="AR World loading error : Your device does not support one or several of it's requested features."}UnsupportedFeatureError.prototype=Object.create(Error.prototype,{constructor:{value:UnsupportedFeatureError,writable:!0,configurable:!0}}),function(){function e(e,r){function t(){return r.info("requesting access for",k.reqFeatures),e(function(e,t){w.requestAccess(function(t){r.debug("requestAccess - success",t),e(t)},function(e){r.error("requestAccess - error",e),t(e)},k.reqFeatures)})}function n(e){m&&angular.isFunction(e)?e():F.push(e)}function o(){return r.debug(Object.getOwnPropertyNames(b)),Object.getOwnPropertyNames(b)}function i(r,t){if("boolean"!=typeof r)throw new TypeError("Ionicitude - captureScreen() expects first parameter to be of type 'boolean', '"+typeof r+"' given.");if(null!==t&&"string"!=typeof t)throw new TypeError("Ionicitude - captureScreen() expects second parameter to be 'null' or of type 'string', '"+typeof t+"' given.");var n=e.defer();return w.captureScreen(function(e){n.resolve(e)},function(e){n.reject(e)},r,t),n.promise}function a(e,r){function t(e){if(b.hasOwnProperty(e))throw new SyntaxError("Ionicitude - addAction() - The name '"+e+"' has already been added or is a reserved Ionicitude name.")}if(angular.isString(e)){if(!r)throw new TypeError("Ionicitude - addAction() expects a second argument if first argument is of type 'string'.");if("function"!=typeof r)throw new TypeError("Ionicitude - addAction() expects second argument to only be of type 'function', '"+typeof r+"' given.");t(e),b[e]=r}else{if(!angular.isFunction(e))throw new TypeError("Ionicitude - addAction() expects first argument to be only of type 'string' or 'function', '"+typeof e+"' given");var n=e.name;if(!n)throw new TypeError("Ionicitude - addAction() do not accept anonymous function as first argument. Please, try passing a named function instead.");t(n),b[n]=e}return y}function u(){r.info("checking device");var t=e.defer();return w.isDeviceSupported(function(e){r.log(e),y.deviceSupportsFeatures=!0,t.resolve(e)},function(e){r.error(e),y.deviceSupportsFeatures=!1,t.reject(e)},k.reqFeatures),t.promise}function c(t){function n(){var e=l;i()&&(e=t.customCallback),w.setOnUrlInvokeCallback(e)}function o(){c()&&(k.reqFeatures=t.reqFeatures),s()&&(k.worldLoadConfig=t.worldLoadConfig),f()&&(k.worldsRootFolder=t.worldsRootFolder)}function i(){return t&&t.hasOwnProperty("customCallback")&&angular.isFunction(t.customCallback)}function a(){return!(t&&t.hasOwnProperty("doDeviceCheck")&&t.doDeviceCheck===!1)}function c(){return t&&t.hasOwnProperty("reqFeatures")&&angular.isArray(t.reqFeatures)}function s(){return t&&t.hasOwnProperty("worldLoadConfig")&&angular.isObject(t.worldLoadConfig)}function f(){return t&&t.hasOwnProperty("worldsRootFolder")&&angular.isString(t.worldsRootFolder)}return e(function(e,t){m?t("Ionicitude has already been initialized !"):(r.info("init service starting"),g().then(h).then(n).then(function(){return a()?u():r.info("check skipped due to init settings")}).then(o).then(function(){m=!0}).then(d).then(function(){r.info("end of initialization"),e(y)}).catch(function(e){t(e)}))})}function s(t){if(t||(t="main"),y.deviceSupportsFeatures){var n=e.defer();return r.info("launch"),w.loadARchitectWorld(function(e){n.resolve(e)},function(e){n.reject(e)},f(t),k.reqFeatures,k.worldLoadConfig),n.promise}throw new UnsupportedFeatureError}function d(){F.forEach(function(e){angular.isFunction(e)&&e()}),F=[]}function f(e){return"www/"+k.worldsRootFolder+"/"+e+"/index.html"}function l(e){var t=p(e);if(r.debug(e,t),!b.hasOwnProperty(t.funcName)||"function"!=typeof b[t.funcName])throw new TypeError("'"+t.funcName+"' is either undefined or not a function in the Ionicitude service.");b[t.funcName](w,t.parameters)}function p(e){if(e=decodeURI(e),e.substr(0,v.length)===v){var r={},t=e.substr(v.length),n=t.indexOf("?");if(n===-1)r.funcName=t,r.parameters=null;else try{r.funcName=t.substr(0,n);var o=t.substr(n+1);r.parameters=angular.fromJson(o)}catch(e){throw e instanceof SyntaxError?new SyntaxError("parseActionUrl() expects the substring following the '?' in the parameter string to be a valid JSON object. '"+o+"' given."):e}return r}throw new SyntaxError("parseActionUrl() expects first parameter to be a string starting with '"+v+"'.")}function g(){return e(function(e,r){w?r("Plugin already loaded !"):(w=cordova.require("com.wikitude.phonegap.WikitudePlugin.WikitudePlugin"),e("Plugin is loaded."))})}function h(){y.close=w.close,y.hide=w.hide,y.show=w.show,y.callJavaScript=w.callJavaScript,y.setLocation=w.setLocation}var w,y={checkDevice:u,requestAccess:t,deviceSupportsFeatures:!1,init:c,launchAR:s,addAction:a,listLibActions:o,captureScreen:i,ready:n,close:null,hide:null,show:null,callJavaScript:null,setLocation:null},m=!1,v="architectsdk://",b={},F=[],k={worldLoadConfig:{camera_position:"back"},reqFeatures:["geo","2d_tracking"],worldsRootFolder:"wikitude-worlds"};return y}e.$inject=["$q","$log"],angular.module("ionicitude-module",[]),angular.module("ionicitude-module").factory("Ionicitude",e)}();