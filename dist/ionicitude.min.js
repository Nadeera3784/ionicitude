"use strict";function UnsupportedFeatureError(){var e=Error.apply(this,arguments);e.name=this.name="UnsupportedFeatureError",this.stack=e.stack,e.message?this.message=e.message:this.message="AR World loading error : Your device does not support one or several of it's requested features."}UnsupportedFeatureError.prototype=Object.create(Error.prototype,{constructor:{value:UnsupportedFeatureError,writable:!0,configurable:!0}}),function(){function e(e,r){function t(e){y&&angular.isFunction(e)?e():F.push(e)}function n(){return e.log(w+"lib actions",Object.getOwnPropertyNames(b)),Object.getOwnPropertyNames(b)}function o(e,t){if("boolean"!=typeof e)throw new TypeError("Ionicitude - captureScreen() expects first parameter to be of type 'boolean', '"+typeof e+"' given.");if(null!==t&&"string"!=typeof t)throw new TypeError("Ionicitude - captureScreen() expects second parameter to be 'null' or of type 'string', '"+typeof t+"' given.");var n=r.defer();return h.captureScreen(function(e){n.resolve(e)},function(e){n.reject(e)},e,t),n.promise}function i(e,r){function t(e){if(b.hasOwnProperty(e))throw new SyntaxError("Ionicitude - addAction() - The name '"+e+"' has already been added or is a reserved Ionicitude name.")}if(angular.isString(e)){if(!r)throw new TypeError("Ionicitude - addAction() expects a second argument if first argument is of type 'string'.");if("function"!=typeof r)throw new TypeError("Ionicitude - addAction() expects second argument to only be of type 'function', '"+typeof r+"' given.");t(e),b[e]=r}else{if(!angular.isFunction(e))throw new TypeError("Ionicitude - addAction() expects first argument to be only of type 'string' or 'function', '"+typeof e+"' given");var n=e.name;if(!n)throw new TypeError("Ionicitude - addAction() do not accept anonymous function as first argument. Please, try passing a named function instead.");t(n),b[n]=e}return m}function a(){e.log(w+"checking device");var t=r.defer();return h.isDeviceSupported(function(r){e.log(w+"checkDevice success",r),m.deviceSupportsFeatures=!0,t.resolve(r)},function(r){e.log(w+"checkDevice error",r),m.deviceSupportsFeatures=!1,t.reject(r)},k.reqFeatures),t.promise}function c(t){function n(){var e=d;i()&&(e=t.customCallback),h.setOnUrlInvokeCallback(e)}function o(){u()&&(k.reqFeatures=t.reqFeatures),l()&&(k.worldLoadConfig=t.worldLoadConfig),f()&&(k.worldsRootFolder=t.worldsRootFolder)}function i(){return t&&t.hasOwnProperty("customCallback")&&angular.isFunction(t.customCallback)}function c(){return!(t&&t.hasOwnProperty("doDeviceCheck")&&!1===t.doDeviceCheck)}function u(){return t&&t.hasOwnProperty("reqFeatures")&&angular.isArray(t.reqFeatures)}function l(){return t&&t.hasOwnProperty("worldLoadConfig")&&angular.isObject(t.worldLoadConfig)}function f(){return t&&t.hasOwnProperty("worldsRootFolder")&&angular.isString(t.worldsRootFolder)}return r(function(r,t){y?t("Ionicitude has already been initialized !"):(e.log(w+"init service starting"),p().then(g).then(n).then(function(){return c()?a():e.log(w+"check skipped due to init settings")}).then(o).then(function(){y=!0}).then(s).then(function(){e.log(w+"end of initialization"),r(m)}).catch(function(e){t(e)}))})}function u(t){if(t||(t="main"),m.deviceSupportsFeatures){var n=r.defer();return e.log(w+"launch"),h.loadARchitectWorld(function(e){n.resolve(e)},function(e){n.reject(e)},l(t),k.reqFeatures,k.worldLoadConfig),n.promise}throw new UnsupportedFeatureError}function s(){F.forEach(function(e){angular.isFunction(e)&&e()}),F=[]}function l(e){return"www/"+k.worldsRootFolder+"/"+e+"/index.html"}function d(r){var t=f(r);if(e.log(w+"executing action call",r,t),!b.hasOwnProperty(t.funcName)||"function"!=typeof b[t.funcName])throw new TypeError("'"+t.funcName+"' is either undefined or not a function in the Ionicitude service.");b[t.funcName](h,t.parameters)}function f(e){if(e=decodeURI(e),e.substr(0,v.length)===v){var r={},t=e.substr(v.length),n=t.indexOf("?");if(-1===n)r.funcName=t,r.parameters=null;else try{r.funcName=t.substr(0,n);var o=t.substr(n+1);r.parameters=angular.fromJson(o)}catch(e){throw e instanceof SyntaxError?new SyntaxError("parseActionUrl() expects the substring following the '?' in the parameter string to be a valid JSON object. '"+o+"' given."):e}return r}throw new SyntaxError("parseActionUrl() expects first parameter to be a string starting with '"+v+"'.")}function p(){return r(function(e,r){h?r("Plugin already loaded !"):(h=cordova.require("com.wikitude.phonegap.WikitudePlugin.WikitudePlugin"),e("Plugin is loaded."))})}function g(){m.close=h.close,m.hide=h.hide,m.show=h.show,m.callJavaScript=h.callJavaScript,m.setLocation=h.setLocation}var h,w="[Ionicitude] ",m={checkDevice:a,deviceSupportsFeatures:!1,init:c,launchAR:u,addAction:i,listLibActions:n,captureScreen:o,ready:t,close:null,hide:null,show:null,callJavaScript:null,setLocation:null},y=!1,v="architectsdk://",b={},F=[],k={worldLoadConfig:{camera_position:"back"},reqFeatures:["geo","image_tracking"],worldsRootFolder:"wikitude-worlds"};return m}e.$inject=["$log","$q"],angular.module("ionicitude-module",[]),angular.module("ionicitude-module").factory("Ionicitude",e)}();